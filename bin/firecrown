#!/usr/bin/env python
import pprint
import click
import firecrown
import pyccl


@click.command()
@click.argument('action', type=str)
@click.argument('config', type=str)
def run(action, config):
    """Watch out! Here comes a firecrown!

    Also, run some ACTION on a CONFIG file."""
    config, data = firecrown.parse(config)
    print("Watch out! Here comes a firecrown!")

    # FIXME: stubby code for testing
    if action == 'compute':
        params = {}
        for p in ['Omega_k', 'Omega_b', 'Omega_c', 'h',
                  'n_s', 'A_s', 'w0', 'wa']:
            if p in config['parameters']:
                val = config['parameters'][p]
                if isinstance(val, list):
                    val=val[1]
                params[p] = val

        cosmo = pyccl.Cosmology(**params)
        loglike, stats = firecrown.compute_loglike(cosmo=cosmo, data=data)
        print('loglike:', loglike)
        print('stats:', pprint.pformat(stats))

    elif action == 'sample':
        firecrown.run_cosmosis(config, data)


if __name__ == '__main__':
    run()
